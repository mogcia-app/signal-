# LLM 投稿戦略パイプライン構想

## 1. ゴールド / ネガティブ投稿の抽出ロジック

- **対象データ**: `posts` コレクション（or `analytics` 集計）から期間内の Instagram 投稿指標を取得  
- **入力 KPI**  
  - いいね数 (`likeCount`)  
  - 保存数 (`saveCount`)  
  - コメント数 (`commentCount`)  
  - リーチ (`reach`)  
  - エンゲージメント率（(いいね + コメント + 保存) / リーチ）  
- **前処理**  
  - アカウント規模補正：フォロワー数で正規化して「リーチ率」「保存率」などを算出  
  - 発生時期の補正：直近 N 件 vs 過去平均を比較して異常値を検知  
- **スコアリング**  
  - 指標ごとに Z スコア or Percentile を算出  
  - 重み付きスコア `score = w1*engagementRate + w2*saveRate + w3*reachGrowth`  
  - `score >= +1σ` を **ゴールド**、`score <= -1σ` を **ネガティブ** としてタグ付け  
- **メタ情報**  
  - 投稿本文 / タグ / メディアタイプ / 曜日 / 投稿時間帯  
  - ゴール（`campaignGoal`）や AI 生成フラグなど、生成プロンプトの根拠になる属性を保持  
- **保存先**  
  - `postPerformanceSnapshots` サブコレクションに日次バッチで保存  
  - LLM へ渡す際は最新 30 件のゴールド＋ネガティブ投稿要約を取得

## 2. LLM 生成プロンプト構成

```
SYSTEM:
あなたはSNSマーケター。ゴールド投稿の成功パターンを活用しつつ、ネガティブ投稿の失敗要因を避けるよう指示する。

USER INPUT:
- 投稿目的: {campaignGoal}
- KPI 状況: {kpiStatusSummary}
- ゴールド投稿要約:
  1. {goldSummary1}（指標: いいね {likeDelta}% ↑, 保存 {saveDelta}% ↑, 特徴: {angles}）
  ...
- ネガティブ投稿警告:
  1. {negativeSummary1}（指標: いいね {likeDelta}% ↓, 失敗要因: {issues}）
- ターゲット: {targetAudience}
- ブランド情報: {businessInfo}

ASSISTANT OUTPUT:
- 投稿案タイトル
- 投稿本文（見出し + 本文 + CTA）
- 推奨ハッシュタグ
- KPI 改善根拠（ゴールド引用・ネガティブ回避要因・現在の KPI 補正）
```

## 3. 学習ダッシュボード拡張案

- **KPI ハイライト**: 直近 30 日の主要 KPI トレンドをカード表示  
  - 例: 「いいね率 -12%」「保存率 +8%」「リーチ 横ばい」  
- **推奨アクション**  
  - ゴールド投稿から抽出した成功フレーズ / CTA / クリエイティブ要素  
  - ネガティブ投稿から回避すべき要素（例: 「長文で離脱」「ハッシュタグ不足」）  
- **LLM 生成の根拠表示**  
  - 投稿生成カードに「根拠: ゴールド投稿 #123 の CTA を引用」「失敗例 #456 の量産投稿を回避」などを表示  
- **タスク化**  
  - KPI 低下項目に対して「LLM 生成案を見る」「再投稿する」などのアクションボタンを配置  
- **将来拡張**  
  - A/B テスト結果の自動取り込み → ゴールドタグ付けに反映  
  - 投稿後のパフォーマンスをフィードバックし、生成プロンプトに自動追加

