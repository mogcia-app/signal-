# 既存 `/instagram/monthly-report` ページ：セクション一覧

## ページ構造

### 共通セクション（常に表示）

#### 1. `ReportHeader` - ヘッダー
- **コンポーネント**: `./components/ReportHeader.tsx`
- **機能**: 
  - 月選択（YYYY-MM形式）
  - ビュー切り替え（"ai" | "metrics"）
- **状態**: `selectedMonth`, `activeView`

#### 2. `PerformanceRating` - パフォーマンス評価
- **コンポーネント**: `./components/PerformanceRating.tsx`
- **表示内容**:
  - アカウントスコア（A〜F評価）
  - PDCAメトリクス（loopScore, planScore, executionRate, feedbackCoverage, adoptionRate）
- **データソース**: `accountScore`, `pdcaMetrics`

---

## AIビュー（`activeView === "ai"`）

### 3. `AIPredictionAnalysis` - AI分析
- **コンポーネント**: `./components/AIPredictionAnalysis.tsx`
- **表示内容**:
  - 月次レビュー（`monthlyReview`）
  - 運用計画の振り返り（`planSummaryText`, `planSimulationSummary`）
  - 計画ハイライト（`planHighlights`）
  - PDCAメトリクス
  - AI生成の分析結果
- **データソース**: 
  - `/api/ai/monthly-analysis`
  - `monthlyReview`
  - `planData`

### 4. `RiskAlerts` - リスクアラート
- **コンポーネント**: `./components/risk-alerts.tsx`
- **表示内容**: AI生成のリスクアラート
- **データソース**: `aiAlerts` (state)

### 5. `PostTypeInsights` - 投稿タイプインサイト
- **コンポーネント**: `./components/PostTypeInsights.tsx`
- **表示内容**: 投稿タイプ別のインサイト（フィード、リール、ストーリー）
- **データソース**: `postTypeHighlights` (state), `unifiedTotalPosts`

### 6. `NextMonthFocusActions` - 来月のフォーカスアクション
- **コンポーネント**: `./components/next-month-focus-actions.tsx`
- **表示内容**: 
  - 来月に向けたアクションプラン
  - アクションログ（実行状況）
- **データソース**: 
  - `reportSummary?.nextMonthFocusActions`
  - `actionLogs` (state)
  - `/api/ai/action-logs`

### 7. `PostDeepDiveSection` - 投稿詳細分析
- **コンポーネント**: `./components/post-deep-dive-section.tsx`
- **表示内容**: 
  - 投稿の詳細分析
  - パターンハイライト（ゴールド/ネガティブ投稿）
- **データソース**: 
  - `reportSummary?.postDeepDive ?? reportSummary?.posts`
  - `reportSummary?.patternHighlights`

### 8. A/Bテスト結果サマリー（インライン）
- **表示内容**: 
  - 完了したA/Bテストの勝者と指標差分
  - バリエーション別のメトリクス
- **データソース**: `reportSummary?.abTestSummaries`

### 9. `LearningReferenceCard` - 学習リファレンス
- **コンポーネント**: `./components/learning-reference-card.tsx`
- **表示内容**: 
  - 学習コンテキスト
  - マスターコンテキスト（学習フェーズ、RAGヒット率など）
  - スナップショット参照
- **データソース**: `reportSummary?.learningContext`

### 10. ペルソナ別反応パターン（インライン）
- **表示内容**: 
  - 性別・年代別の反応パターン
  - 参照投稿
- **データソース**: `reportSummary?.personaHighlights`

### 11. `FeedbackSentimentCard` - フィードバック感情分析
- **コンポーネント**: `./components/feedback-sentiment-card.tsx`
- **表示内容**: 
  - フィードバックの感情分析（ポジティブ/ネガティブ/ニュートラル）
  - コメントハイライト
- **データソース**: `reportSummary?.feedbackSentiment`

---

## メトリクスビュー（`activeView === "metrics"`）

### 12. `MetricsCards` - メトリクスカード
- **コンポーネント**: `./components/MetricsCards.tsx`
- **表示内容**: 
  - いいね数（前月比）
  - コメント数（前月比）
  - シェア数（前月比）
  - リーチ数（前月比）
  - フォロワー増減（前月比）
  - 投稿数（前月比）
- **データソース**: 
  - `currentTotals`, `previousTotals`, `changes`

### 13. `KPIDrilldownSection` - KPI詳細
- **コンポーネント**: `./components/kpi-drilldown-section.tsx`
- **表示内容**: 
  - リーチの内訳（投稿、プロフィール、発見タブ、検索、その他）
  - 保存数の内訳（投稿タイプ別）
  - フォロワー増減の内訳（投稿タイプ別）
  - エンゲージメントの内訳（いいね、コメント、シェア、保存）
- **データソース**: `reportSummary?.kpiBreakdowns`

### 14. `DetailedStats` - 詳細統計
- **コンポーネント**: `./components/DetailedStats.tsx`
- **表示内容**: 
  - アカウントスコアの詳細
  - 前月との比較
- **データソース**: 
  - `accountScore`
  - `previousPeriodData`
  - `reportSummary`

### 15. `VisualizationSection` - 可視化セクション
- **コンポーネント**: `./components/VisualizationSection.tsx`
- **表示内容**: 
  - 日別スコアグラフ
  - トレンドグラフ
- **データソース**: 
  - `dailyScores`
  - `reportSummary`

### 16. `TimeSlotHeatmap` - 時間帯ヒートマップ
- **コンポーネント**: `./components/time-slot-heatmap.tsx`
- **表示内容**: 
  - 最適な投稿時間帯のヒートマップ
  - 時間帯別のエンゲージメント
- **データソース**: `reportSummary?.timeSlotAnalysis`

### 17. `AdvancedAnalysis` - 高度な分析
- **コンポーネント**: `./components/AdvancedAnalysis.tsx`
- **表示内容**: 
  - 最適な投稿時間帯
  - 高度な分析結果
- **データソース**: `reportSummary`

### 18. `ContentPerformanceSection` - コンテンツパフォーマンス
- **コンポーネント**: `./components/content-performance-section.tsx`
- **表示内容**: 
  - フィードのパフォーマンス統計
  - リールのパフォーマンス統計
- **データソース**: 
  - `reportSummary?.contentPerformance?.feed`
  - `reportSummary?.contentPerformance?.reel`

### 19. `AudienceBreakdownSection` - オーディエンス内訳
- **コンポーネント**: `./components/audience-breakdown-section.tsx`
- **表示内容**: 
  - フィードのオーディエンス内訳（性別、年代）
  - リールのオーディエンス内訳（性別、年代）
- **データソース**: 
  - `reportSummary?.contentPerformance?.feed?.audienceBreakdown`
  - `reportSummary?.contentPerformance?.reel?.audienceBreakdown`

---

## 使用されているAPI

### 初期ロード時
1. `/api/analytics/monthly-report-summary` - メインサマリー
2. `/api/analytics/account-score` - アカウントスコア（当月）
3. `/api/analytics/account-score` - アカウントスコア（前月）
4. `/api/analytics/daily-scores` - 日別スコア

### 1秒後
5. `/api/analytics/monthly-review` - 月次レビュー

### ユーザー操作時
6. `/api/ai/monthly-analysis` - AI分析（「振り返りを見る」ボタンクリック時）
7. `/api/ai/action-logs` - アクションログ（`activeView === "ai"` の時）

---

## セクションの分類

### 必須セクション（新規ページでも必要）
1. ✅ `ReportHeader` - ヘッダー（月選択）
2. ✅ `PerformanceRating` - パフォーマンス評価（A〜F評価、PDCA実行度）

### オプションセクション（必要に応じて追加）
3. ⚠️ `MetricsCards` - メトリクスカード（KPI表示）
4. ⚠️ `KPIDrilldownSection` - KPI詳細（詳細分析）
5. ⚠️ `DetailedStats` - 詳細統計（前月比）

### 削除候補セクション（シンプル化で不要）
6. ❌ `AIPredictionAnalysis` - AI分析（複雑すぎる）
7. ❌ `RiskAlerts` - リスクアラート（AI分析に依存）
8. ❌ `PostTypeInsights` - 投稿タイプインサイト（AI分析に依存）
9. ❌ `NextMonthFocusActions` - 来月のフォーカスアクション（AI分析に依存）
10. ❌ `PostDeepDiveSection` - 投稿詳細分析（複雑すぎる）
11. ❌ A/Bテスト結果サマリー（A/Bテスト機能に依存）
12. ❌ `LearningReferenceCard` - 学習リファレンス（複雑すぎる）
13. ❌ ペルソナ別反応パターン（複雑すぎる）
14. ❌ `FeedbackSentimentCard` - フィードバック感情分析（複雑すぎる）
15. ❌ `VisualizationSection` - 可視化セクション（オプション）
16. ❌ `TimeSlotHeatmap` - 時間帯ヒートマップ（オプション）
17. ❌ `AdvancedAnalysis` - 高度な分析（オプション）
18. ❌ `ContentPerformanceSection` - コンテンツパフォーマンス（オプション）
19. ❌ `AudienceBreakdownSection` - オーディエンス内訳（オプション）

---

## 新規ページでの推奨構成

### フェーズ1: 最小構成
1. `ReportHeader` - ヘッダー
2. `PerformanceRating` - パフォーマンス評価（A〜F評価、PDCA実行度）
3. `MetricsCards` - メトリクスカード（基本的なKPI）

### フェーズ2: 詳細追加（必要に応じて）
4. `KPIDrilldownSection` - KPI詳細
5. `DetailedStats` - 詳細統計

### フェーズ3以降: オプション機能（必要に応じて）
6. `VisualizationSection` - 可視化セクション
7. その他の詳細分析セクション

---

## データフロー

### 現在のデータフロー（複雑）
```
初期ロード
  ↓
Promise.all([
  monthly-report-summary,  // 5コレクション
  account-score (当月),    // 1コレクション
  account-score (前月),    // 1コレクション
  daily-scores            // 2コレクション
])
  ↓
1秒後
  ↓
monthly-review           // 4コレクション
  ↓
ユーザー操作
  ↓
monthly-analysis         // 12コレクション
action-logs              // 1コレクション
```

### 新規ページのデータフロー（シンプル）
```
初期ロード
  ↓
Promise.all([
  performance-score,     // 3コレクション（analytics, posts, plans）
  pdca-execution-rate    // 3コレクション（同じデータを再利用可能）
])
```

**合計: 3コレクションのみ**（現在の12コレクションから大幅削減）

