# 新規月次レポートページ実装計画

## 方針

既存の `/instagram/monthly-report` は触らず、新しい `/instagram/report` を最小構成で作成し、段階的に機能を追加する。

## 実装ステップ

### フェーズ1: 最小構成（MVP）

#### 1.1 新規ページ作成
```
/instagram/report
```

#### 1.2 最小限のAPI実装
- `GET /api/analytics/performance-score?date=YYYY-MM`
  - パフォーマンス評価スコア（A〜F）
  - 必要なデータのみ取得

#### 1.3 最小限のUI
- ヘッダー（月選択）
- パフォーマンス評価スコア表示（A〜F）
- 基本的なKPI表示（いいね、リーチ、保存、コメント）

#### 1.4 必要なインデックス追加
- `analytics`: `userId` (ASC) + `publishedAt` (ASC)
- `posts`: `userId` (ASC) + `createdAt` (ASC)
- `plans`: `userId` (ASC) + `snsType` (ASC) + `status` (ASC)

### フェーズ2: PDCA実行度追加

#### 2.1 API実装
- `GET /api/analytics/pdca-execution-rate?date=YYYY-MM`
  - PDCA実行度（％）

#### 2.2 UI追加
- PDCA実行度表示

### フェーズ3: 詳細KPI表示

#### 3.1 データ拡張
- 前月比表示
- グラフ表示（日別スコア）

#### 3.2 UI追加
- KPIカード
- グラフコンポーネント

### フェーズ4: 機能統合

#### 4.1 既存機能の移行（必要に応じて）
- AI分析（オプション）
- 詳細分析（オプション）

#### 4.2 テスト
- 動作確認
- パフォーマンステスト

### フェーズ5: 切り替え

#### 5.1 新規ページの完成確認
- 機能確認
- パフォーマンス確認

#### 5.2 既存ページの削除
- `/instagram/monthly-report` を削除
- リダイレクト設定（必要に応じて）

## ファイル構成

```
src/app/instagram/report/
├── page.tsx                    # メインページ（最小構成）
├── components/
│   ├── ReportHeader.tsx        # ヘッダー（月選択）
│   ├── PerformanceScore.tsx    # パフォーマンス評価表示
│   ├── PDCAExecutionRate.tsx   # PDCA実行度表示
│   └── KPICards.tsx            # KPIカード
└── hooks/
    └── useReportData.ts        # データ取得フック

src/app/api/analytics/
├── performance-score/
│   └── route.ts                # パフォーマンス評価API
└── pdca-execution-rate/
    └── route.ts                # PDCA実行度API
```

## 実装の原則

### 1. 最小構成から開始
- 最初はパフォーマンス評価スコアのみ
- 必要最小限のデータのみ取得

### 2. 段階的に追加
- 各フェーズで動作確認
- 問題があれば前のフェーズに戻れる

### 3. シンプルな設計
- 複雑な依存関係を避ける
- 1つのAPI = 1つの責務

### 4. パフォーマンス重視
- 必要なデータのみ取得
- サーバー側でフィルタリング
- インデックスを適切に使用

## 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **言語**: TypeScript
- **状態管理**: React Hooks (useState, useEffect)
- **データ取得**: fetch API
- **スタイリング**: Tailwind CSS

## メリット

### 1. リスク最小化
- 既存ページに影響なし
- 段階的に実装できる

### 2. シンプルな設計
- 複雑さを避けられる
- 保守性が向上

### 3. パフォーマンス向上
- 最小限のデータ取得
- 高速なロード

### 4. テスト容易
- 各フェーズでテスト可能
- 問題の特定が容易

## 次のステップ

1. **フェーズ1の実装開始**
   - 新規ページ作成
   - 最小限のAPI実装
   - 基本的なUI実装

2. **動作確認**
   - ローカル環境でテスト
   - パフォーマンス確認

3. **段階的に機能追加**
   - フェーズ2以降を順次実装

## 注意事項

⚠️ **既存ページは触らない**
- `/instagram/monthly-report` は一切変更しない
- 新規ページのみ実装

⚠️ **段階的な実装**
- 一度に全部作らない
- 各フェーズで動作確認

⚠️ **テストを重視**
- 各フェーズでテスト
- 問題があれば修正

