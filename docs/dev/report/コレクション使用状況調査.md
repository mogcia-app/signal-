# Firestoreコレクション使用状況調査

## コードベース全体で使用されているコレクション

### 1. `analytics` ✅ 使用中
- **使用箇所**: 多数のAPIで使用
- **用途**: 投稿の分析データ（いいね、コメント、シェア、リーチなど）
- **削除**: ❌ 不可（コアデータ）

### 2. `posts` ✅ 使用中
- **使用箇所**: 多数のAPIで使用
- **用途**: 投稿データ
- **削除**: ❌ 不可（コアデータ）

### 3. `users` ✅ 使用中
- **使用箇所**: 多数のAPIで使用
- **用途**: ユーザープロファイル
- **削除**: ❌ 不可（コアデータ）

### 4. `plans` ✅ 使用中
- **使用箇所**: 複数のAPIで使用
- **用途**: 運用計画データ
- **削除**: ❌ 不可（コアデータ）

### 5. `ai_post_feedback` ✅ 使用中
- **使用箇所**: 
  - `/api/analytics/monthly-report-summary`
  - `/api/ai/monthly-analysis`
  - `/api/ai/feedback`
  - `/api/posts/[id]`
- **用途**: AI生成のフィードバックデータ
- **削除**: ❌ 不可（月次レポートで使用）

### 6. `ai_action_logs` ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/api/ai/action-logs`
  - `/api/posts/[id]`
- **用途**: AI生成のアクションプランのログ
- **削除**: ❌ 不可（月次レポートで使用）

### 7. `ai_overview_history` ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/api/ai/overview-history`
- **用途**: AI生成の概要履歴データ
- **削除**: ❌ 不可（月次レポートで使用）

### 8. `ab_tests` ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/api/ab-tests`
  - `/lib/analytics/ab-test-utils.ts`
  - `/lib/ai/context.ts`
- **用途**: A/Bテストの結果データ
- **削除**: ❌ 不可（月次レポートで使用）

### 9. `ai_master_context_cache` ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/lib/ai/context.ts`
- **用途**: AIマスターコンテキストのキャッシュ
- **削除**: ❌ 不可（月次レポートで使用）

### 10. `userSchedules` ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/api/instagram/schedule-save`
- **用途**: ユーザーのスケジュールデータ
- **削除**: ❌ 不可（月次レポートで使用）

### 11. `postPerformanceSnapshots` (サブコレクション) ✅ 使用中
- **使用箇所**: 
  - `/api/ai/monthly-analysis`
  - `/api/analytics/snapshots`
  - `/lib/analytics/snapshot-generator.ts`
  - `/lib/ai/context.ts`
- **用途**: 投稿パフォーマンスのスナップショット
- **削除**: ❌ 不可（月次レポートで使用）

### 12. `ai_post_summaries` ✅ 使用中
- **使用箇所**: 
  - `/api/analytics/ai-insight`
  - `/api/ai/post-summaries`
- **用途**: AI生成の投稿サマリー
- **削除**: ❌ 不可（他の機能で使用）

## 月次レポートで使用されているが、簡素化で削除できる可能性があるコレクション

### 検討対象

#### 1. `ai_overview_history`
- **月次レポートでの使用**: 履歴表示（現在は使用されていない可能性）
- **他の機能での使用**: `/api/ai/overview-history`
- **削除可否**: ⚠️ 要確認（月次レポートで使用されていない場合は削除可能）

#### 2. `ai_master_context_cache`
- **月次レポートでの使用**: マスターコンテキスト取得
- **他の機能での使用**: `/lib/ai/context.ts`
- **削除可否**: ⚠️ 要確認（キャッシュなので削除しても再生成可能）

#### 3. `userSchedules`
- **月次レポートでの使用**: 投稿スケジュール分析
- **他の機能での使用**: `/api/instagram/schedule-save`
- **削除可否**: ⚠️ 要確認（月次レポートで必須でない場合は削除可能）

## 推奨アクション

### 1. 使用状況の確認
以下のコレクションが実際に使用されているか確認：
- `ai_overview_history` - 月次レポートで使用されていない可能性
- `ai_master_context_cache` - キャッシュなので削除可能
- `userSchedules` - 月次レポートで必須でない可能性

### 2. 削除候補
シンプル化提案に基づき、以下のコレクションは不要になる可能性：
- 月次レポートの簡素化により、一部のコレクションアクセスが不要になる

### 3. 確認方法
1. 各コレクションの使用箇所を確認
2. 月次レポートで実際に使用されているか確認
3. 他の機能で使用されているか確認
4. 削除可能なコレクションを特定

## 注意事項

⚠️ **コレクションの削除は慎重に**
- データのバックアップを取る
- 本番環境での削除前に開発環境でテスト
- 他の機能への影響を確認

