# BFFパターン移行計画

## 目的
フロントエンドに露出している計算ロジックやビジネスロジックをバックエンドに移行し、ブラックボックス化する。

## 実施内容

### 1. 計画シミュレーション計算の移行 ✅

**変更前:**
- `src/app/instagram/plan/page.tsx`で`calculateSimulation`を直接呼び出し
- `src/app/instagram/plan/utils/calculations.ts`に計算ロジックが露出

**変更後:**
- 新しいAPIエンドポイント `/api/instagram/plan-simulation` を作成
- すべての計算ロジックをバックエンドに移動
- フロントエンドはAPIから結果を受け取るだけ

**影響範囲:**
- `src/app/instagram/plan/page.tsx`: `calculateSimulation`の呼び出しをAPI呼び出しに変更
- `src/app/instagram/plan/utils/calculations.ts`: バックエンド専用として残す（他のAPIルートで使用されている可能性があるため）

### 2. 今後の対応項目

#### 2.1 PDCAメトリクス計算
- 現在は既にバックエンド（`/api/home/pdca-status`）で計算されている ✅
- フロントエンドには計算式が露出していない ✅

#### 2.2 その他の計算ロジック
- フォロワー成長率計算
- エンゲージメント率計算
- 投稿頻度計算
- など、すべてバックエンドで実行されているか確認が必要

### 3. セキュリティ上の利点

1. **計算式の保護**: ビジネスロジックがクライアントサイドに露出しない
2. **改ざん防止**: クライアント側で計算結果を改ざんできない
3. **一貫性**: すべての計算がサーバー側で統一されたロジックで実行される
4. **監査**: すべての計算リクエストがサーバー側でログに記録される

### 4. パフォーマンス上の考慮事項

- API呼び出しのレイテンシが追加されるが、計算処理は軽量なため影響は最小限
- 必要に応じてキャッシュを検討

### 5. 本番環境での確認事項

- [ ] フロントエンドのバンドルサイズから計算ロジックが除外されているか
- [ ] 開発者ツールで計算式が見えないか
- [ ] ネットワークタブでAPI呼び出しが正しく行われているか


















