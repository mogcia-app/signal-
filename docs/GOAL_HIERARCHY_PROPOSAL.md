# 目標の階層構造提案

作成日: 2026-01-30

## 問題点

現在の課題：
- `/onboarding`で「目標」と「課題」を設定
- 事業者によっては、月ごとに目標が変わる（今月はこれを目標にしたい、来月はこれにしたい）
- `/instagram/plan`で変更できるようにしたが、それだとごちゃつく
- どれが「基本方針」でどれが「今月の目標」なのかが分からなくなる

## 提案：階層構造の明確化

### 1. 役割の明確化

#### `/onboarding`（基本方針・長期目標）
- **役割**: ビジネスの根幹となる基本方針
- **変更頻度**: 低い（数ヶ月〜数年単位で変更）
- **表示名**: 「基本方針・長期目標」
- **説明**: 「この目標は、あなたのビジネスの根幹となる基本方針です。月ごとに変わる目標は、運用計画ページで設定できます。」

#### `/instagram/plan`（今月の目標・短期方針）
- **役割**: 月ごとに変わる具体的な目標
- **変更頻度**: 高い（月ごとに変更可能）
- **表示名**: 「今月の目標」
- **説明**: 「今月の運用で特に重視したい目標を設定してください。基本方針を参考にしながら、今月の重点を決めましょう。」

### 2. UI/UXの改善

#### `/onboarding`の改善
```
【基本方針・長期目標】
この目標は、あなたのビジネスの根幹となる基本方針です。
月ごとに変わる目標は、運用計画ページで設定できます。

目標: [既存の目標表示]
課題: [既存の課題表示]
```

#### `/instagram/plan`の改善
```
【今月の目標設定】

基本方針（参考）:
- 目標: [onboardingの目標を表示]
- 課題: [onboardingの課題を表示]

今月の目標（この月で特に重視したい目標）:
[ ] 基本方針と同じ
[ ] 今月は別の目標にしたい
  → [テキスト入力欄]

今月の課題（この月で特に注意したい課題）:
[ ] 基本方針と同じ
[ ] 今月は別の課題にしたい
  → [テキスト入力欄]
```

### 3. データ構造の改善

#### `plans`コレクションに追加するフィールド
```typescript
{
  // 既存フィールド...
  
  // 月次目標（新規）
  monthlyGoals?: string[]; // 今月の目標（空の場合はonboardingのgoalsを継承）
  monthlyChallenges?: string[]; // 今月の課題（空の場合はonboardingのchallengesを継承）
  useBaseGoals?: boolean; // 基本方針と同じ目標を使うかどうか
  useBaseChallenges?: boolean; // 基本方針と同じ課題を使うかどうか
}
```

### 4. AI生成時の優先順位

1. **最優先**: `/instagram/plan`で設定した`monthlyGoals`と`monthlyChallenges`
2. **フォールバック**: `/onboarding`の`goals`と`challenges`
3. **説明**: AI生成時に「今月の目標」と「基本方針」を明確に区別して参照

### 5. 実装の詳細

#### `/onboarding`の変更
- 「目標と課題」セクションのタイトルを「基本方針・長期目標」に変更
- 説明文を追加：「この目標は、あなたのビジネスの根幹となる基本方針です。月ごとに変わる目標は、運用計画ページで設定できます。」

#### `/instagram/plan`の変更
- 「目標とターゲット設定」セクションに「今月の目標」を追加
- 基本方針を参照として表示
- 「基本方針と同じ」または「今月は別の目標にしたい」を選択可能
- 選択に応じて、テキスト入力欄を表示/非表示

#### AI生成時の処理
- `buildPlanPrompt()`で、`monthlyGoals`があればそれを優先、なければ`onboarding.goals`を使用
- プロンプトに「今月の目標」と「基本方針」を明確に区別して記載

## メリット

1. **明確な役割分担**: 基本方針と今月の目標が明確に分かれる
2. **柔軟性**: 月ごとに目標を変更できる
3. **一貫性**: 基本方針を参照として表示することで、一貫性を保てる
4. **ユーザビリティ**: どれが「基本」でどれが「今月の目標」なのかが一目で分かる

## 実装の優先順位

1. **Phase 1**: `/onboarding`の説明文追加とタイトル変更
2. **Phase 2**: `/instagram/plan`に「今月の目標」セクションを追加
3. **Phase 3**: データ構造の拡張（`monthlyGoals`、`monthlyChallenges`の追加）
4. **Phase 4**: AI生成時の優先順位ロジックの実装

