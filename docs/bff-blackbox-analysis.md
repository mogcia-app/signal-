# BFFパターン - ブラックボックス化対象の分析

## フロントエンドに露出しているロジック

### 1. ✅ 既に移行済み（計算ロジック）

#### 1.1 計画シミュレーション計算
- **移行前**: `src/app/instagram/plan/page.tsx`で`calculateSimulation`を直接呼び出し
- **移行後**: `/api/instagram/plan-simulation` APIエンドポイント経由
- **状態**: ✅ 完了

#### 1.2 目標フォロワー数自動計算
- **移行前**: `TargetFollowerAutoInput.tsx`で月間成長率0.8%の計算式が露出
- **移行後**: `/api/instagram/target-followers` APIエンドポイント経由
- **状態**: ✅ 完了

### 2. 🔴 ブラックボックス化が必要なロジック

#### 2.1 文字数制限・バリデーションルール
**問題点:**
- `PostEditor.tsx`に`maxCharacters = 2200`がハードコードされている
- フィード投稿の文字数制限（150文字など）がフロントエンドに露出

**推奨対応:**
- 文字数制限をバックエンドAPIから取得
- バリデーションルールをバックエンドで実行

#### 2.2 ハッシュタグ正規化・バリデーション
**問題点:**
- `PostEditorHashtags.tsx`や`post-editor-utils.ts`にハッシュタグの正規化ロジックが露出
- ハッシュタグの最大数、最小数などのルールがフロントエンドに露出

**推奨対応:**
- ハッシュタグの正規化をバックエンドで実行
- ハッシュタグのバリデーションルールをバックエンドで管理

#### 2.3 スケジュール検証ロジック
**問題点:**
- `feed/page.tsx`にスケジュールの妥当性チェックロジックが露出
- 投稿頻度の判定基準がフロントエンドに露出

**推奨対応:**
- スケジュール検証をバックエンドAPIで実行
- 判定基準をバックエンドで管理

#### 2.4 コメント内の計算式説明
**問題点:**
- `TargetFollowerAutoInput.tsx`のコメントに計算式が記載されている
- ビジネスロジックがコメントとして露出

**推奨対応:**
- コメントから計算式の説明を削除
- または、一般的な説明に変更

#### 2.5 データ変換・フォーマット処理
**問題点:**
- フロントエンドでデータ変換ロジックが実行されている
- フォーマット処理がフロントエンドに露出

**推奨対応:**
- データ変換をバックエンドで実行
- フロントエンドは表示用のフォーマットのみ実行

### 3. 📋 確認が必要なロジック

#### 3.1 画像圧縮ロジック
- `image-utils.ts`に画像圧縮ロジックが存在
- クライアントサイドでの圧縮はパフォーマンス上必要だが、圧縮パラメータはバックエンドから取得すべき

#### 3.2 UI判定ロジック
- 表示/非表示の判定ロジック
- これらはUI固有のため、フロントエンドに残すべき

## 優先度

### 高優先度
1. **文字数制限・バリデーションルール** - ビジネスルールが露出
2. **ハッシュタグ正規化・バリデーション** - ビジネスルールが露出
3. **スケジュール検証ロジック** - ビジネスルールが露出

### 中優先度
4. **コメント内の計算式説明** - コメントとして露出（機密性は低いが削除推奨）
5. **データ変換・フォーマット処理** - 一部はUI固有のため、バックエンドに移行すべきもののみ

### 低優先度
6. **画像圧縮ロジック** - パフォーマンス上の理由でクライアントサイドで実行が必要


















