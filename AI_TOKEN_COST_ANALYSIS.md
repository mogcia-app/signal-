# AIトークン数・コスト分析

## 📊 現状のAI使用箇所

### 使用されているAPI
1. **AI戦略生成** - `/api/instagram/ai-strategy` (gpt-4o-mini)
2. **AI診断** - `/api/instagram/ai-diagnosis` (gpt-4o-mini)
3. **月次分析** - `/api/ai/monthly-analysis` (gpt-4o-mini)
4. **AIチャット** - `/api/ai/chat` (gpt-4o-mini)
5. **投稿生成** - `/api/ai/post-generation` (gpt-4o-mini)
6. **月次レビュー** - `/api/analytics/monthly-review` (gpt-4o-mini)

## 💰 料金（2024年10月時点）

### モデル別料金
- **gpt-4o-mini**: 
  - 入力: $0.15/1Mトークン
  - 出力: $0.60/1Mトークン
- **gpt-4o** (以前使用していたモデル):
  - 入力: $5.00/1Mトークン
  - 出力: $15.00/1Mトークン
- **差額**: gpt-4o-miniは約**97%安い**

## 📈 月間コスト見積もり

### ユーザー1人あたり（想定使用頻度）

| 機能 | モデル | 入力 | 出力 | 使用頻度 | コスト/回 | 月間コスト |
|------|--------|------|------|----------|-----------|------------|
| AI戦略 | gpt-4o-mini | 3,000 | 1,500 | 1回/月 | $0.006 | $0.01 |
| AI診断 | gpt-4o-mini | 5,000 | 2,000 | 1回/月 | $0.008 | $0.01 |
| 月次分析 | gpt-4o-mini | 1,000 | 800 | 1回/月 | $0.002 | $0.00 |
| 月次レビュー | gpt-4o-mini | 1,000 | 800 | 1回/月 | $0.002 | $0.00 |
| AIチャット | gpt-4o-mini | 500 | 500 | 10回/月 | $0.001 | $0.01 |
| 投稿生成 | gpt-4o-mini | 2,000 | 300 | 5回/月 | $0.004 | $0.02 |

**合計**: 約**$0.05/月/ユーザー**（gpt-4o-mini使用時）

### 従来のgpt-4o使用時のコスト

| 機能 | 使用頻度 | gpt-4oのコスト |
|------|----------|----------------|
| AI戦略 | 1回/月 | $0.15 |
| AI診断 | 1回/月 | $0.25 |
| 月次分析 | 1回/月 | $0.02 |
| 月次レビュー | 1回/月 | $0.02 |
| AIチャット | 10回/月 | $1.00 |
| 投稿生成 | 5回/月 | $0.20 |

**合計**: 約**$1.62/月/ユーザー**

## 🎯 スケール別コスト見積もり

### 100ユーザー
- **gpt-4o-mini**: 約$5/月
- **gpt-4o** (以前): 約$162/月
- **削減額**: $157/月 (97%削減)

### 1,000ユーザー
- **gpt-4o-mini**: 約$50/月
- **gpt-4o** (以前): 約$1,620/月
- **削減額**: $1,570/月 (97%削減)

### 10,000ユーザー
- **gpt-4o-mini**: 約$500/月
- **gpt-4o** (以前): 約$16,200/月
- **削減額**: $15,700/月 (97%削減)

## 🔧 コスト削減施策

### ✅ 実施済み（2024年10月）
1. **gpt-4o → gpt-4o-miniに変更**
   - 効果: 97%のコスト削減
   - 影響: 品質は若干低下するが実用上の問題なし

### 💡 今後の追加施策
1. **プロンプトの最適化**
   - 不要な情報を削減
   - 効果: 20-30%のコスト削減見込み

2. **キャッシング実装**
   - 同じような質問への再利用
   - 効果: 30-50%のコスト削減見込み

3. **レート制限の強化**
   - 過剰な使用を抑制
   - 効果: 10-20%のコスト削減見込み

## 📊 推奨アプローチ

### 現時点の設定で問題なし
- **gpt-4o-mini**は十分に高品質
- 1,000ユーザーでも月$50程度で運用可能
- コストパフォーマンスが良い

### より厳密なコスト管理が必要な場合
1. **使用量モニタリング**
   - 各APIの使用回数を追跡
   - 予算アラート設定

2. **ユーザー別コスト制限**
   - 月間使用上限を設定
   - 超過時にアラート

3. **バッチ処理の導入**
   - 頻繁な更新が必要ない処理はバッチ化
   - リアルタイム性とコストのバランス

## 📝 注意事項

- 上記の見積もりは**想定値**であり、実際の使用量は変動します
- ユーザー行動に応じて調整が必要です
- 定期的な監視と見直しを推奨します

